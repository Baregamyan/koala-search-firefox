{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://koala-search/./src/components/FocusControl.js","webpack://koala-search/./src/const.js","webpack://koala-search/./src/main.js"],"sourcesContent":["import {KeyCode} from '../const';\n\n/**\n * @class\n */\nexport default class FocusControl {\n  /**\n   * @param {HTMLElement} resultsContainer - Class name of results container.\n   * @param {HTMLElement} searchForm - Search form.\n   * @param {string} resultClass - Class name of result container.\n   */\n  constructor(resultsContainer, searchForm, resultClass) {\n    this._resultsContainer = resultsContainer;\n    this._searchForm = searchForm;\n    this._resultClass = `.${resultClass}`;\n    this._results = this._resultsContainer.querySelectorAll(this._resultClass);\n    this._linkListeners = [];\n    this._documentListeners = [];\n\n    this._onLinkBlur = this._blur.bind(this);\n    this._onLinkFocus = this._focus.bind(this);\n    this._onDocumentKeydown = this._keydown.bind(this);\n    this._onDocumentKeyup = this._keyup.bind(this);\n\n    this._indexActiveLink = 0;\n\n    this._isAnyLinkFocused = false;\n\n    this._isShiftPressed;\n  }\n\n  /**\n   * Search form focus flag.\n   */\n  get _isSearchFormFocused() {\n    return document.activeElement === this._searchForm;\n  }\n\n  /**\n   * Create event listener callback.\n   * @param {string} eventName - Event name.\n   * @param {Object} callback - Function.\n   * @return {Object}\n   */\n  _createListener(eventName, callback) {\n    return {\n      eventName: eventName,\n      callback: callback,\n    };\n  }\n\n  /**\n   * Add to links needed classes and event listeners.\n   */\n  _initLinks() {\n    this._links = Array.from(this._results)\n        .map((result) => this._setLink(result.querySelector('a')))\n        .filter((link, index, array) => array.indexOf(link) === index);\n  }\n\n  /**\n   * Fill listeners.\n   */\n  _fillListeners() {\n    this._documentListeners.push(\n        this._createListener('keydown', this._onDocumentKeydown)\n    );\n    this._documentListeners.push(\n        this._createListener('keyup', this._onDocumentKeyup)\n    );\n\n    this._linkListeners.push(\n        this._createListener('blur', this._onLinkBlur)\n    );\n  }\n\n  /**\n   * @param {HTMLElement} element - Element for event listener.\n   * @param {Array} listeners - Event listeners for element.\n   */\n  _setListeners(element, listeners) {\n    listeners.forEach((listener) => {\n      const {eventName, callback} = listener;\n      element.addEventListener(eventName, callback);\n    });\n  }\n\n  /**\n   * Blur link event.\n   */\n  _blur() {\n    this._isAnyLinkFocused = false;\n    this._activeElement.classList.toggle('active', false);\n    this._activeElement = null;\n  }\n\n  /**\n   * Focus link event.\n   * @param {HTMLElement} link - HTML element on link.\n   */\n  _focus(link) {\n    link.focus();\n    link.scrollIntoView({block: 'center'});\n    this._activeElement = link.parentElement.parentElement;\n    this._activeElement.classList.toggle('active', true);\n  }\n\n  /**\n   * @param {HTMLElement} link - HTML link element.\n   * @return {HTMLElement} - Ready link.\n   */\n  _setLink(link) {\n    this._linkListeners.forEach((listener) => {\n      const {eventName, callback} = listener;\n      link.addEventListener(eventName, callback);\n      link.classList.toggle('link', true);\n    });\n    return link;\n  }\n\n  /**\n   * Keydown on keyboard.\n   * @param {Object} evt - Event\n   */\n  _keydown(evt) {\n    if (!this._isSearchFormFocused) {\n      if (evt.keyCode === KeyCode.UP) {\n        evt.preventDefault();\n        this._up();\n      }\n\n      if (evt.keyCode === KeyCode.RIGHT) {\n        if (this._indexActiveLink === (this._links.length - 1)) {\n          evt.preventDefault();\n        }\n      }\n\n      if (evt.keyCode === KeyCode.DOWN) {\n        evt.preventDefault();\n        this._down();\n      }\n\n      if (evt.keyCode === KeyCode.TAB) {\n        evt.preventDefault();\n        if (this._isShiftPressed) {\n          this._up();\n        } else {\n          this._down();\n        }\n      }\n\n      if (evt.keyCode === KeyCode.SHIFT) {\n        this._isShiftPressed = true;\n      }\n    }\n  }\n\n  /**\n   * Keyup on keyboard.\n   * @param {Object} evt - Event.\n   */\n  _keyup(evt) {\n    if (evt.keyCode === KeyCode.SHIFT) {\n      this._isShiftPressed = false;\n    }\n  }\n\n  /**\n   * Init focus control.\n   */\n  init() {\n    this._fillListeners();\n    console.log('listenners filled');\n    this._initLinks();\n\n    this._setListeners(document, this._documentListeners);\n    this._focus(this._links[0]);\n  }\n\n  /**\n   * Focus goes up.\n   */\n  _up() {\n    if (!(this._indexActiveLink === 0)) {\n      this._indexActiveLink -= 1;\n    } else {\n      this._indexActiveLink = 0;\n    }\n    this._focus(this._links[this._indexActiveLink]);\n  }\n\n  /**\n   * Focus goes down.\n   */\n  _down() {\n    if (!(this._indexActiveLink === this._links.length - 1)) {\n      this._indexActiveLink += 1;\n    } else {\n      this._indexActiveLink = this._links.length - 1;\n    }\n    this._focus(this._links[this._indexActiveLink]);\n  }\n}\n","export const KeyCode = {\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  LEFT: 37,\n  TAB: 9,\n  SHIFT: 16,\n};\n","import FocusControl from './components/FocusControl';\n\nconsole.log('before find elements');\nconst search = document.querySelector('#search');\nconst searchForm = document.querySelector('#searchform').querySelector('input');\nconst focusController = new FocusControl(search, searchForm, 'g');\n\nconsole.log(focusController);\nconsole.log('beforeinit');\n\nfocusController.init();\n"],"names":["FocusControl","resultsContainer","searchForm","resultClass","this","_resultsContainer","_searchForm","_resultClass","_results","querySelectorAll","_linkListeners","_documentListeners","_onLinkBlur","_blur","bind","_onLinkFocus","_focus","_onDocumentKeydown","_keydown","_onDocumentKeyup","_keyup","_indexActiveLink","_isAnyLinkFocused","_isShiftPressed","document","activeElement","eventName","callback","_links","Array","from","map","result","_setLink","querySelector","filter","link","index","array","indexOf","push","_createListener","element","listeners","forEach","listener","addEventListener","_activeElement","classList","toggle","focus","scrollIntoView","block","parentElement","evt","_isSearchFormFocused","keyCode","preventDefault","_up","length","_down","_fillListeners","console","log","_initLinks","_setListeners","focusController","init"],"sourceRoot":""}